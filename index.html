<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>급식 정보 제공 홈페이지</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive.css">
</head>
<body>
    <header>
        <h1 id="school-title">경덕중학교 오늘의 급식</h1>
    </header>
    <main>
        <section id="school-search">
            <h2>학교 검색</h2>
            <div class="search-container">
                <input type="text" id="school-name" placeholder="학교명을 입력하세요">
                <button id="search-school">학교 검색</button>
            </div>
            <div id="school-list">
                <!-- 검색된 학교 목록이 여기에 표시됩니다 -->
            </div>
        </section>
        <section id="meal-info">
            <h2>오늘의 급식 정보</h2>
            <!-- 식사 시간 선택 버튼 -->
            <div class="meal-selector">
              <button onclick="loadMeal('LUNCH')" class="active">점심</button>
              <button onclick="loadMeal('BREAKFAST')">아침</button>  
              <button onclick="loadMeal('DINNER')">저녁</button>
            </div>
            <div id="meal-list">
                <!-- 급식 정보가 여기에 표시됩니다 -->
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 경덕중학교</p>
    </footer>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script>
      // 기본적으로 페이지 로드 시 점심 정보 표시
      document.addEventListener('DOMContentLoaded', () => {
        // 저장된 학교 정보 확인 및 제목 업데이트
        updateSchoolTitle();
        loadMeal('LUNCH');
      });

      // 선택된 식사 시간에 따라 급식 정보 로드
      function loadMeal(mealType) {
        // 버튼 활성화 상태 변경
        document.querySelectorAll('.meal-selector button').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // 선택된 식사 시간에 대한 급식 정보 가져오기
        window.mealApi.getMealInfo(undefined, undefined, window.mealApi.MEAL_CODES[mealType])
          .then(result => {
            if (result.success) {
              displayMealInfo(result.data);
            } else {
              displayError(result.message);
            }
          });
      }

      // 학교 제목 업데이트 함수
      function updateSchoolTitle() {
        const savedSchool = localStorage.getItem('selectedSchool');
        if (savedSchool) {
          const { schoolName } = JSON.parse(savedSchool);
          document.getElementById('school-title').textContent = `${schoolName} 오늘의 급식`;
          document.querySelector('footer p').textContent = `© ${schoolName}`;
        }
      }

      // 새로운 학교를 선택했을 때 제목도 업데이트하는 함수
      function selectSchool(schoolCode, eduCode, schoolName) {
        // 학교 정보 저장
        localStorage.setItem('selectedSchool', JSON.stringify({ 
          schoolCode, 
          eduCode,
          schoolName
        }));
        
        // 제목 업데이트
        updateSchoolTitle();
        
        // 선택된 식사 타입으로 급식 정보 다시 로드
        const activeButton = document.querySelector('.meal-selector button.active');
        if (activeButton) {
          const mealType = activeButton.textContent === '점심' ? 'LUNCH' : 
                          activeButton.textContent === '아침' ? 'BREAKFAST' : 'DINNER';
          loadMeal(mealType);
        } else {
          loadMeal('LUNCH');
        }
      }
    </script>
</body>
</html>